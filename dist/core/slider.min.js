import t from"./details.min.js";import{generateId as e,objectsAreEqual as n}from"./utils.min.js";function i(i,o,r){let l,a={};function s(e=!1){const i=l.details,o=t(l);l.details=o,e||n(i,o)?e&&l.emit("detailsChanged"):l.emit("detailsChanged")}function c(){l.container.style.setProperty("--slider-container-width",`${l.details.containerWidth}px`),l.container.style.setProperty("--slider-scrollable-width",`${l.details.scrollableAreaWidth}px`),l.container.style.setProperty("--slider-slides-count",`${l.details.slideCount}`)}function d(){l.container.setAttribute("data-has-overflow",l.details.hasOverflow?"true":"false")}return l={emit:function(t){var e;a&&a[t]&&a[t].forEach((t=>{t(l)}));const n=null===(e=null==l?void 0:l.options)||void 0===e?void 0:e[t];"function"==typeof n&&n(l)},moveToDirection:function(t="prev"){const e=l.options.scrollStrategy,n=l.container.scrollLeft,i=l.container.getBoundingClientRect(),o=l.container.offsetWidth;let r=n;if("prev"===t?r=Math.max(0,n-l.container.offsetWidth):"next"===t&&(r=Math.min(l.container.scrollWidth,n+l.container.offsetWidth)),"fullSlide"===e){let e=null;const a=Array.from(l.container.querySelectorAll(":scope > *"));let s=0;if(a.length>1){const t=a[0].getBoundingClientRect();s=a[1].getBoundingClientRect().left-t.right}if(e="prev"===t?Math.max(0,r-s):Math.min(l.container.scrollWidth,r+s),"next"===t){let t=!1;for(let o of a){const l=o.getBoundingClientRect(),a=l.left-i.left+n,s=a+l.width;if(a<r&&s>r){e=a,t=!0;break}}t||(e=Math.min(r,l.container.scrollWidth-l.container.offsetWidth)),e&&e>n&&(r=e)}else{let t=!1;for(let r of a){const l=r.getBoundingClientRect(),a=l.left-i.left+n,s=a+l.width;if(a<n&&s>n){e=s-o,t=!0;break}}t||(e=Math.max(0,n-o)),e&&e<n&&(r=e)}}l.container.style.scrollBehavior=l.options.scrollBehavior,l.container.scrollLeft=r,setTimeout((()=>l.container.style.scrollBehavior=""),50)},on:function(t,e){a[t]||(a[t]=[]),a[t].push(e)},options:o},function(){l.container=i;let t=i.getAttribute("id");null===t&&(t=e("overflow-slider"),i.setAttribute("id",t)),s(!0),l.on("contentsChanged",(()=>s())),l.on("containerSizeChanged",(()=>s()));let n=0;if(l.on("scroll",(()=>{n&&window.cancelAnimationFrame(n),n=window.requestAnimationFrame((()=>{s()}))})),function(){new MutationObserver((()=>l.emit("contentsChanged"))).observe(l.container,{childList:!0});new ResizeObserver((()=>l.emit("containerSizeChanged"))).observe(l.container),l.container.addEventListener("scroll",(()=>l.emit("scroll")));let t=!1;l.container.addEventListener("mousedown",(()=>{t=!0})),l.container.addEventListener("touchstart",(()=>{t=!0}),{passive:!0}),l.container.addEventListener("focusin",(e=>{if(!t){let t=e.target;for(;t.parentElement!==l.container&&t.parentElement;)t=t.parentElement;!function(t){const e=t.getBoundingClientRect(),n=l.container.getBoundingClientRect(),i=l.container.offsetWidth,o=l.container.scrollLeft,r=e.left-n.left+o,a=r+e.width;let s=null;r<o?s=r:a>o+i&&(s=a-i);s&&(l.container.style.scrollSnapType="none",l.container.scrollLeft=s)}(t)}t=!1}))}(),d(),c(),r)for(const t of r)t(l);l.on("detailsChanged",(()=>{d(),c()})),l.emit("created")}(),l}export{i as default};
